package com.xf.util

import org.apache.spark.ml.feature.{OneHotEncoderEstimator, StringIndexer}
import org.apache.spark.sql.{DataFrame, SparkSession}

/**
  * Created by wei.wang on 2018/9/17 0017.
  * +-------------------+----------+---------------+---------------+--------------------+-------+-------+---------+---------------+---+---+------+-------+-------+---------+-------+---------------------+-----------+-----------+-------------------+-----------+---------+---------+--------------------+-------------+--------------+---------------+----------------+--------------------+--------------+-------------------+---------------------+--------+----------------+
  * |        instance_id|      time|           city|       province|           user_tags|carrier|devtype|     make|          model|nnt| os|   osv|os_name|   adid|advert_id|orderid|advert_industry_inner|campaign_id|creative_id|    creative_tp_dnf|app_cate_id|f_channel|   app_id|       inner_slot_id|creative_type|creative_width|creative_height|creative_is_jump|creative_is_download|creative_is_js|creative_is_voicead|creative_has_deeplink|app_paid|     advert_name|
  * +-------------------+----------+---------------+---------------+--------------------+-------+-------+---------+---------------+---+---+------+-------+-------+---------+-------+---------------------+-----------+-----------+-------------------+-----------+---------+---------+--------------------+-------------+--------------+---------------+----------------+--------------------+--------------+-------------------+---------------------+--------+----------------+
  * |6930856710792380886|2190675456|137103104101100|137103104100100|                    |      2|      2|    Apple|  iPhone 8 Plus|  1|  1|11.4.1|    ios|1518579|230000063|3006011|        102400_102401|    1000023|    2316955|8390430283595430291|      103.0|         |1030051.0|xf_6C4DCB36DBE7EB...|            8|           960|            640|            True|               False|         False|              False|                False|   False|B4734117F35EE97F|
  * |5460409694420131920|2190674821|137103104112100|137103104100100|3004406,3004430,3...|      1|      2|     vivo|    vivo X9Plus|  1|  2| 7.1.2|android|1580740|230000063|3005949|        102400_102401|    1000023|    2334795|8390430283595430291|      108.0|         |1080001.0|xf_826A5605FD0EBC...|            8|           960|            640|            True|               False|         False|              False|                False|   False|B4734117F35EE97F|
  * | 982813438159141507|2190674111|137105103101100|137105103100100|3003779,3003843,3...|      2|      2|OPPO A73t|      OPPO A73t|  4|  2| 7.1.1|android|1585472|230000063|3012756|        102400_102401|    1000023|    2313211|8390465404427801098|      111.0|         |1110016.0|xf_EE10823F5C5D57...|            5|           160|            640|            True|               False|         False|              False|                False|   False|B4734117F35EE97F|
  * | 529991959116679673|2190675256|137106101107100|137106101100100|                    |      2|      2|  vivo Z1|        vivo Z1|  4|  2| 8.1.0|android|1575100|230000063|2311393|        102400_102401|    1000023|    2334795|8390430283595430291|      111.0|         |1110016.0|xf_9EFA0BFCFEDCE6...|            8|           960|            640|            True|               False|         False|              False|                False|   False|B4734117F35EE97F|
  * |5357053206615171780|2190673926|137103102101100|137103102100100|2100191,2100041,2...|      3|      2|   HUAWEI|HUAWEI MLA-AL10|  4|  2|   6.0|android|1584212|230000191|3012566|        101700_101704|    1003348|    2338134|8390272894417697957|      107.0|         |1000049.0|xf_64FAC0085FC8DC...|            5|           320|            480|            True|               False|         False|              False|                False|   False|42A4CB9035B7F50E|
  * | 792454096205931185|2190673414|137101104111100|137101104100100|2100142,2100138,2...|      1|      2|   GIONEE|           F100|  1|  2| 5.1.0|android|1585512|230000063|3006301|        102400_102401|    1000023|    2334795|8390430283595430291|      107.0|         |2089229.0|xf_275C061483984E...|            8|           960|            640|            True|               False|         False|              False|                False|   False|B4734117F35EE97F|
  * |7020394095530516431|2190673410|137103106101100|137103106100100|     3004430,3004434|      1|      2|   Xiaomi| HM NOTE 1LTETD|  4|  2| 4.4.4|android|1580242|230001696|3011878|        101000_101002|    1003456|    2341928|8390272894417697957|      100.0|         |2089353.0|xf_271FC16F77AC34...|            5|           320|            480|            True|               False|         False|              False|                False|   False|310405E93895BD58|
  * |3223889685220093136|2190672226|137104104118100|137104104100100|                    |      1|      2|iPhone9,2|      iPhone9,2|  4|  1|11.2.2|    ios|1584598|230000063|3012642|        102400_102401|    1000023|    2334795|8390430283595430291|      111.0|         |1110016.0|xf_90C0240F17510F...|            8|           960|            640|            True|               False|         False|              False|                False|   False|B4734117F35EE97F|
  * |6022950513423196038|2190674025|137104101107100|137104101100100|     3004430,3004434|      2|      2|    LeEco|        Le X620|  1|  2|   6.0|android|1547080|230000065|3009240|        101700_101704|    1000021|    2338402|8390430283595430291|      107.0|         |2070969.0|xf_14BC8A931A7395...|            8|           960|            640|            True|               False|         False|              False|                False|   False|E257895F74792E81|
  * |8354622923398290680|2190674828|137104101101100|137104101100100|2100963,2100078,2...|      1|      2|     OPPO|  OPPO-R9s-Plus|  3|  2| 6.0.1|android|1585926|230001025|3011318|        101700_101704|    1001979|    2342960|8390430283595430291|      107.0|         |2089229.0|xf_275C061483984E...|            8|           960|            640|            True|               False|         False|              False|                False|   False|50822F8310CAE01D|
  * |7690103784039999411|2190674653|137103102102100|137103102100100|                    |      1|      2|     OPPO|       OPPO R9s|  4|  2| 6.0.1|android|1584418|230001025|3012606|        101700_101704|    1001979|    2332997|8390430283595430291|      108.0|         |2071003.0|xf_E604BF307039B0...|            8|           960|            640|            True|               False|         False|              False|                False|   False|50822F8310CAE01D|
  * |5358262661276445953|2190673978|137105101100100|137105101100100|gd_2100001,ag_210...|      1|      2|   Xiaomi|        2014813|  4|  2| 4.4.4|android|1537089|230000065|3008491|        101700_101704|    1000021|    2337017|8390430283595430291|      100.0|         |2089397.0|xf_7F9FF3BEA11FE5...|            8|           960|            640|            True|               False|         False|              False|                False|   False|E257895F74792E81|
  * |  85281227856840133|2190674681|137103106101100|137103106100100|,3003209,3003211,...|      1|      2|     OPPO|       OPPO R11|  1|  2| 7.1.1|android|1579100|230000063|3012048|        102400_102401|    1000023|    2342158|8390430283595430291|      111.0|         |2089441.0|xf_43A9C5B2909813...|            8|           960|            640|            True|               False|         False|              False|                False|   False|B4734117F35EE97F|
  * |5516720759995212120|2190675373|137104104101100|137104104100100|,3002617,3002847,...|      2|      2|    nubia|         NX531J|  4|  2| 6.0.1|android|1453927|230000063|2307861|        102400_102401|    1000023|    2317979|8390422898336367555|      107.0|         |1100001.0|xf_1587571EC08158...|            2|           100|            640|            True|               False|         False|              False|                False|   False|B4734117F35EE97F|
  * |6034220552009226001|2190673893|137104103104100|137104103100100|                    |      3|      2|   Xiaomi|  Redmi+Note+4X|  1|  2|   7.0|android|1537089|230000065|3008491|        101700_101704|    1000021|    2337017|8390430283595430291|      100.0|         |2089397.0|xf_7F9FF3BEA11FE5...|            8|           960|            640|            True|               False|         False|              False|                False|   False|E257895F74792E81|
  * |4346026994855587682|2190673040|137105101100100|137105101100100|3004406,3004430,3...|      1|      2|   HUAWEI|       COL-AL10|  4|  2| 8.1.0|android|1586078|230001449|3012850|        101700_101704|    1002913|    2342984|8390422898336367555|      107.0|         |1100001.0|xf_1587571EC08158...|            2|           100|            640|            True|               False|         False|              False|                False|   False|CC4602621BE800EA|
  * |2510829946206717570|2190673848|137106102107100|137106102100100|     3004430,3004434|      1|      2|     OPPO|      OPPO A37m|  1|  2|   5.1|android|1584418|230001025|3012606|        101700_101704|    1001979|    2332997|8390430283595430291|      108.0|         |2071003.0|xf_E604BF307039B0...|            8|           960|            640|            True|               False|         False|              False|                False|   False|50822F8310CAE01D|
  * |8632119382197977662|2190672509|137102103102100|137102103100100|3004059,3004430,3...|      1|      2|     vivo|      vivo-Y67L|  1|  2| 6.0.0|android|1586084|230000063|3012854|        102400_102401|    1000023|    2334795|8390430283595430291|      107.0|         |2089229.0|xf_275C061483984E...|            8|           960|            640|            True|               False|         False|              False|                False|   False|B4734117F35EE97F|
  * |3356938582169526102|2190673150|137102103101100|137102103100100|2100078,3002097,3...|      2|      2|   Xiaomi|           MI 6|  4|  2| 8.0.0|android|1579632|230000971|3012242|            16_100509|    1002549|    2341348|8390430283595430291|      115.0|         |2090626.0|xf_8CDAE9567B8F0E...|            8|           960|            640|            True|               False|         False|              False|                False|   False|D54E631F07CA4751|
  * |7717605286446460982|2190674186|137103101100100|137103101100100|                    |      2|      2|    Apple|      iPhone8,1|  1|  1|11.4.1|    ios|1581246|230001587|3012430|        101700_101799|    1003624|    2342564|8390430283595430291|      108.0|         |2071005.0|xf_B2110F504257E0...|            8|           960|            640|            True|               False|         False|              False|                False|   False|1D3BD714403AE0FF|
  * +-------------------+----------+---------------+---------------+--------------------+-------+-------+---------+---------------+---+---+------+-------+-------+---------+-------+---------------------+-----------+-----------+-------------------+-----------+---------+---------+--------------------+-------------+--------------+---------------+----------------+--------------------+--------------+-------------------+---------------------+--------+----------------+
  *
  * 数据清洗
  */
object DataFormat {
  /**
    * 对make和model列进行编码,将字符串转换成整型
    *
    * @param dataframe
    * @return
    */
  def oneHotEncording(columnOld:String,columnNew:String,dataframe: DataFrame, spark: SparkSession): DataFrame = {
    val indexer = new StringIndexer()
      .setInputCol(columnOld).setOutputCol(columnNew)
    val model = indexer.fit(dataframe)
    model.transform(dataframe)
  }


}
